// tslint:disable: rxjs-no-wholesale rxjs-deep-operators
import { map, concatMap, startWith, filter, switchMap, debounceTime, catchError } from 'rxjs/operators';
import { pipe, of } from 'rxjs';
export function batchAll(service, params) {
    return service.all(params).pipe(concatMap(collection => {
        if (collection.data.length < params.page.size) {
            return of(collection);
        }
        params.page.number += 1;
        return batchAll(service, params).pipe(startWith(collection));
    }));
}
export const filterOrRequest = (params) => pipe(startWith(''), debounceTime(400), filter(filterValue => typeof filterValue === 'string'), switchMap((filterValue) => {
    if (filterValue.includes(params.last_filter_value) && params.collection.data.length < params.page_size) {
        return of(params.resourcesArray.filter((resource) => resource.attributes[params.attribute_to_search].toLowerCase().indexOf(filterValue) >= 0));
    }
    return params
        .getAllFc(filterValue)
        .pipe(catchError(() => [])).pipe(map((collection) => {
        params.collection = collection;
        params.resourcesArray = collection.data;
        params.last_filter_value = filterValue;
        return params.resourcesArray;
    }));
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmF0Y2guanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtanNvbmFwaS1tYXRlcmlhbC8iLCJzb3VyY2VzIjpbImxpYi9iYXRjaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSx3REFBd0Q7QUFFeEQsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFHLE1BQU0sRUFBRyxTQUFTLEVBQVUsWUFBWSxFQUFHLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25ILE9BQU8sRUFBZSxJQUFJLEVBQUcsRUFBRSxFQUFrQixNQUFNLE1BQU0sQ0FBQztBQU05RCxNQUFNLFVBQVUsUUFBUSxDQUEyQyxPQUFVLEVBQUUsTUFBeUI7SUFDcEcsT0FBMEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxFQUFFO1FBQ3RGLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDM0MsT0FBTyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDekI7UUFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUM7UUFFeEIsT0FBTyxRQUFRLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUNqRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ1IsQ0FBQztBQUVELE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxDQUFxQixNQU9uRCxFQUEyRCxFQUFFLENBQzFELElBQUksQ0FDQSxTQUFTLENBQUMsRUFBRSxDQUFDLEVBQ2IsWUFBWSxDQUFDLEdBQUcsQ0FBQyxFQUNqQixNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxPQUFPLFdBQVcsS0FBSyxRQUFRLENBQUMsRUFDdEQsU0FBUyxDQUFDLENBQUMsV0FBbUIsRUFBRSxFQUFFO0lBQzlCLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsSUFBSSxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRTtRQUNwRyxPQUFPLEVBQUUsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVcsRUFBRSxFQUFFLENBQ25ELFFBQVEsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDakc7SUFFRCxPQUFPLE1BQU07U0FDUixRQUFRLENBQUMsV0FBVyxDQUFDO1NBQ3JCLElBQUksQ0FDRCxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQ3ZCLENBQUMsSUFBSSxDQUNOLEdBQUcsQ0FBQyxDQUFDLFVBQWlDLEVBQUUsRUFBRTtRQUN0QyxNQUFNLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUMvQixNQUFNLENBQUMsY0FBYyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUM7UUFDeEMsTUFBTSxDQUFDLGlCQUFpQixHQUFHLFdBQVcsQ0FBQztRQUV2QyxPQUFPLE1BQU0sQ0FBQyxjQUFjLENBQUM7SUFDakMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNaLENBQUMsQ0FBQyxDQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZTogcnhqcy1uby13aG9sZXNhbGUgcnhqcy1kZWVwLW9wZXJhdG9yc1xuXG5pbXBvcnQgeyBtYXAsIGNvbmNhdE1hcCwgc3RhcnRXaXRoICwgZmlsdGVyICwgc3dpdGNoTWFwICwgc2tpcCAsIGRlYm91bmNlVGltZSAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlICwgcGlwZSAsIG9mICwgVW5hcnlGdW5jdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBTZXJ2aWNlIH0gZnJvbSAnbmd4LWpzb25hcGkvc2VydmljZSc7XG5pbXBvcnQgeyBSZXNvdXJjZSB9IGZyb20gJ25neC1qc29uYXBpL3Jlc291cmNlJztcbmltcG9ydCB7IERvY3VtZW50Q29sbGVjdGlvbiwgSVBhcmFtc0NvbGxlY3Rpb24gfSBmcm9tICduZ3gtanNvbmFwaSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBiYXRjaEFsbDxUIGV4dGVuZHMgU2VydmljZTxSPiwgUiBleHRlbmRzIFJlc291cmNlPihzZXJ2aWNlOiBULCBwYXJhbXM6IElQYXJhbXNDb2xsZWN0aW9uKTogT2JzZXJ2YWJsZTxEb2N1bWVudENvbGxlY3Rpb248Uj4+IHtcbiAgICByZXR1cm4gPE9ic2VydmFibGU8RG9jdW1lbnRDb2xsZWN0aW9uPFI+Pj5zZXJ2aWNlLmFsbChwYXJhbXMpLnBpcGUoY29uY2F0TWFwKGNvbGxlY3Rpb24gPT4ge1xuICAgICAgICBpZiAoY29sbGVjdGlvbi5kYXRhLmxlbmd0aCA8IHBhcmFtcy5wYWdlLnNpemUpIHtcbiAgICAgICAgICAgIHJldHVybiBvZihjb2xsZWN0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBhcmFtcy5wYWdlLm51bWJlciArPSAxO1xuXG4gICAgICAgIHJldHVybiBiYXRjaEFsbChzZXJ2aWNlLCBwYXJhbXMpLnBpcGUoc3RhcnRXaXRoKGNvbGxlY3Rpb24pKTtcbiAgICB9KSk7XG59XG5cbmV4cG9ydCBjb25zdCBmaWx0ZXJPclJlcXVlc3QgPSA8VCBleHRlbmRzIFJlc291cmNlPihwYXJhbXM6IHtcbiAgICBhdHRyaWJ1dGVfdG9fc2VhcmNoPzogc3RyaW5nO1xuICAgIHJlc291cmNlc0FycmF5OiBBcnJheTxUPjtcbiAgICBnZXRBbGxGYzogKChmaWx0ZXI6IHN0cmluZykgPT4gT2JzZXJ2YWJsZTxEb2N1bWVudENvbGxlY3Rpb248VD4+KTtcbiAgICBsYXN0X2ZpbHRlcl92YWx1ZTogc3RyaW5nO1xuICAgIGNvbGxlY3Rpb246IERvY3VtZW50Q29sbGVjdGlvbjxUPjtcbiAgICBwYWdlX3NpemU6IG51bWJlcjtcbn0pOiBVbmFyeUZ1bmN0aW9uPE9ic2VydmFibGU8c3RyaW5nPiwgT2JzZXJ2YWJsZTxBcnJheTxUPj4+ID0+XG4gICAgcGlwZShcbiAgICAgICAgc3RhcnRXaXRoKCcnKSxcbiAgICAgICAgZGVib3VuY2VUaW1lKDQwMCksXG4gICAgICAgIGZpbHRlcihmaWx0ZXJWYWx1ZSA9PiB0eXBlb2YgZmlsdGVyVmFsdWUgPT09ICdzdHJpbmcnKSxcbiAgICAgICAgc3dpdGNoTWFwKChmaWx0ZXJWYWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICBpZiAoZmlsdGVyVmFsdWUuaW5jbHVkZXMocGFyYW1zLmxhc3RfZmlsdGVyX3ZhbHVlKSAmJiBwYXJhbXMuY29sbGVjdGlvbi5kYXRhLmxlbmd0aCA8IHBhcmFtcy5wYWdlX3NpemUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2YocGFyYW1zLnJlc291cmNlc0FycmF5LmZpbHRlcigocmVzb3VyY2U6IFQpID0+XG4gICAgICAgICAgICAgICAgICAgIHJlc291cmNlLmF0dHJpYnV0ZXNbcGFyYW1zLmF0dHJpYnV0ZV90b19zZWFyY2hdLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihmaWx0ZXJWYWx1ZSkgPj0gMCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zXG4gICAgICAgICAgICAgICAgLmdldEFsbEZjKGZpbHRlclZhbHVlKVxuICAgICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgICAgICBjYXRjaEVycm9yKCgpID0+IFtdKVxuICAgICAgICAgICAgICAgICkucGlwZShcbiAgICAgICAgICAgICAgICBtYXAoKGNvbGxlY3Rpb246IERvY3VtZW50Q29sbGVjdGlvbjxUPikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5yZXNvdXJjZXNBcnJheSA9IGNvbGxlY3Rpb24uZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmxhc3RfZmlsdGVyX3ZhbHVlID0gZmlsdGVyVmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5yZXNvdXJjZXNBcnJheTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pXG4gICAgKTtcbiJdfQ==