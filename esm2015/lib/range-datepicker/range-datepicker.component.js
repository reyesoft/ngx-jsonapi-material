import { Component, Input, Output, EventEmitter } from '@angular/core';
import { DatePipe } from '@angular/common';
const start_time = [0, 0, 0];
const end_time = [23, 59, 59];
export class RangeDatepickerComponent {
    constructor(datePipe) {
        this.datePipe = datePipe;
        this.startDateChange = new EventEmitter();
        this.endDateChange = new EventEmitter();
        this.updateDate = new EventEmitter();
    }
    ngOnInit() {
        this.label = 'Rango de fecha';
    }
    onDateInput(event) {
        this.lastDateInput = event.value;
        this.updateDateChange(this.lastDateInput.begin, this.lastDateInput.end);
    }
    onDateChange(event) {
        this.lastDateChange = event.value;
        this.updateDateChange(this.lastDateChange.begin, this.lastDateChange.end);
    }
    applyCustomRange(event, picker) {
        event.stopPropagation();
        picker.open();
    }
    applyLastWeek() {
        this.endDate = new Date();
        this.startDate = new Date();
        this.startDate.setDate(this.endDate.getDate() - 6);
        this.date = { begin: this.startDate, end: this.endDate };
        this.updateDateChange(this.startDate, this.endDate);
    }
    applyToday() {
        this.startDate = this.endDate = new Date();
        this.date = { begin: this.startDate, end: this.endDate };
        this.updateDateChange(this.startDate, this.endDate);
    }
    applyCurrentMonth() {
        let today = new Date();
        this.startDate = new Date(today.getFullYear(), today.getMonth(), 1);
        this.endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        this.date = { begin: this.startDate, end: this.endDate };
        this.updateDateChange(this.startDate, this.endDate);
    }
    clearRange(event) {
        event.stopPropagation();
        this.date = null;
        this.updateDateChange(null, null);
        this.label = 'Rango de fecha';
    }
    applylastMonth() {
        let today = new Date();
        this.startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
        this.endDate = new Date(today.getFullYear(), today.getMonth(), 0);
        this.date = { begin: this.startDate, end: this.endDate };
        this.updateDateChange(this.startDate, this.endDate);
    }
    updateDateChange(start_date, end_date) {
        this.startDate = start_date;
        this.endDate = end_date;
        this.label = this.togglePreviewText(start_date, end_date);
        this.startDateChange.emit(this.formatDateAndAddTime(start_date, start_time));
        this.endDateChange.emit(this.formatDateAndAddTime(end_date, end_time));
        this.updateDate.emit();
    }
    togglePreviewText(start_date, end_date) {
        if (start_date && end_date) {
            return this.createPreviewText(start_date, end_date).toUpperCase();
        }
        if (start_date) {
            return this.getDays(start_date).toUpperCase();
        }
        if (end_date) {
            return this.getDays(end_date).toUpperCase();
        }
    }
    getDays(date) {
        let today = new Date();
        if (date.getDate() === today.getDate()) {
            return 'hoy';
        }
        return this.datePipe.transform(date, 'dd MMM yyyy');
    }
    createPreviewText(start_date, end_date) {
        if (start_date.getFullYear() !== end_date.getFullYear()) {
            return (this.datePipe.transform(start_date, 'dd MMM yyyy - ') +
                this.datePipe.transform(end_date, 'dd MMM yyyy'));
        }
        if (start_date.getMonth() === end_date.getMonth()) {
            if (this.compareDaysOfTheSameMonth())
                return this.getDays(start_date);
            return (this.datePipe.transform(start_date, 'dd - ') +
                this.datePipe.transform(end_date, 'dd') +
                this.datePipe.transform(end_date, ' MMM yyyy'));
        }
        return (this.datePipe.transform(start_date, 'dd MMM - ') +
            this.datePipe.transform(end_date, 'dd MMM') +
            this.datePipe.transform(end_date, ' yyyy'));
    }
    compareDaysOfTheSameMonth() {
        if (this.startDate.getDate() === this.endDate.getDate())
            return true;
    }
    formatDateAndAddTime(date, time) {
        date.setHours(time[0], time[1], time[2]);
        return date;
    }
}
RangeDatepickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'jam-range-datepicker',
                template: `<mat-form-field [matTooltip]="label">
    <mat-select [placeholder]="label">
        <mat-option (click)="applyCustomRange($event, resultPicker); $event.stopPropagation()" fxLayout="row" fxLayoutAlign="space-between center">
            <sat-datepicker-toggle matPrefix [for]="resultPicker"></sat-datepicker-toggle>
            <input matInput
                placeholder="Rango personalizado"
                #resultPickerModel="ngModel"
                [satDatepicker]="resultPicker"
                [(ngModel)]="date"
                (dateInput)="onDateInput($event)"
                (dateChange)="onDateChange($event)">
            <sat-datepicker
                [disabled]="false"
                #resultPicker [rangeMode]="true">
            </sat-datepicker>

            <div matSuffix fxFlex="10">
                <button mat-icon-button matTooltip="Limpiar filtro" (click)="clearRange($event)">
                    <mat-icon>clear</mat-icon>
                </button>
            </div>
        </mat-option>

        <mat-option (click)="applyToday()">Hoy</mat-option>
        <mat-option (click)="applyLastWeek()">Ãšltima semana</mat-option>
        <mat-option (click)="applyCurrentMonth()">Este mes</mat-option>
        <mat-option (click)="applylastMonth()">El mes pasado</mat-option>
    </mat-select>
</mat-form-field>
`,
                providers: [DatePipe],
                styles: [`mat-form-field{font-size:15px}`]
            },] },
];
/** @nocollapse */
RangeDatepickerComponent.ctorParameters = () => [
    { type: DatePipe }
];
RangeDatepickerComponent.propDecorators = {
    startDate: [{ type: Input }],
    endDate: [{ type: Input }],
    startDateChange: [{ type: Output }],
    endDateChange: [{ type: Output }],
    updateDate: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZ2UtZGF0ZXBpY2tlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtanNvbmFwaS1tYXRlcmlhbC8iLCJzb3VyY2VzIjpbImxpYi9yYW5nZS1kYXRlcGlja2VyL3JhbmdlLWRhdGVwaWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFL0UsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTNDLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUM3QixNQUFNLFFBQVEsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFxQzlCLE1BQU0sT0FBTyx3QkFBd0I7SUFhakMsWUFBNkIsUUFBa0I7UUFBbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUo5QixvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFDM0Msa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQ3pDLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO0lBRUosQ0FBQztJQUU1QyxRQUFRO1FBQ1gsSUFBSSxDQUFDLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQztJQUNsQyxDQUFDO0lBRU0sV0FBVyxDQUFDLEtBQW9DO1FBQ25ELElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLEtBQXNDLENBQUM7UUFDbEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUVNLFlBQVksQ0FBQyxLQUFvQztRQUNwRCxJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQyxLQUFzQyxD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LENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FDN0MsQ0FBQztJQUNOLENBQUM7SUFFTyx5QkFBeUI7UUFDN0IsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFO1lBQUUsT0FBTyxJQUFJLENBQUM7SUFDekUsQ0FBQztJQUVPLG9CQUFvQixDQUFDLElBQVUsRUFBRSxJQUFtQjtRQUN4RCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFekMsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQzs7O1lBM0tKLFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsc0JBQXNCO2dCQUNoQyxRQUFRLEVBQUU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0NBNkJiO2dCQUNHLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQztnQkFDckIsTUFBTSxFQUFFLENBQUMsZ0NBQWdDLENBQUM7YUFDN0M7Ozs7WUF2Q1EsUUFBUTs7O3dCQThDWixLQUFLO3NCQUNMLEtBQUs7OEJBRUwsTUFBTTs0QkFDTixNQUFNO3lCQUNOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTYXREYXRlcGlja2VyUmFuZ2VWYWx1ZSwgU2F0RGF0ZXBpY2tlcklucHV0RXZlbnQgfSBmcm9tICdzYXR1cm4tZGF0ZXBpY2tlcic7XG5pbXBvcnQgeyBEYXRlUGlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbmNvbnN0IHN0YXJ0X3RpbWUgPSBbMCwgMCwgMF07XG5jb25zdCBlbmRfdGltZSA9IFsyMywgNTksIDU5XTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdqYW0tcmFuZ2UtZGF0ZXBpY2tlcicsXG4gICAgdGVtcGxhdGU6IGA8bWF0LWZvcm0tZmllbGQgW21hdFRvb2x0aXBdPVwibGFiZWxcIj5cbiAgICA8bWF0LXNlbGVjdCBbcGxhY2Vob2xkZXJdPVwibGFiZWxcIj5cbiAgICAgICAgPG1hdC1vcHRpb24gKGNsaWNrKT1cImFwcGx5Q3VzdG9tUmFuZ2UoJGV2ZW50LCByZXN1bHRQaWNrZXIpOyAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKClcIiBmeExheW91dD1cInJvd1wiIGZ4TGF5b3V0QWxpZ249XCJzcGFjZS1iZXR3ZWVuIGNlbnRlclwiPlxuICAgICAgICAgICAgPHNhdC1kYXRlcGlja2VyLXRvZ2dsZSBtYXRQcmVmaXggW2Zvcl09XCJyZXN1bHRQaWNrZXJcIj48L3NhdC1kYXRlcGlja2VyLXRvZ2dsZT5cbiAgICAgICAgICAgIDxpbnB1dCBtYXRJbnB1dFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiUmFuZ28gcGVyc29uYWxpemFkb1wiXG4gICAgICAgICAgICAgICAgI3Jlc3VsdFBpY2tlck1vZGVsPVwibmdNb2RlbFwiXG4gICAgICAgICAgICAgICAgW3NhdERhdGVwaWNrZXJdPVwicmVzdWx0UGlja2VyXCJcbiAgICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cImRhdGVcIlxuICAgICAgICAgICAgICAgIChkYXRlSW5wdXQpPVwib25EYXRlSW5wdXQoJGV2ZW50KVwiXG4gICAgICAgICAgICAgICAgKGRhdGVDaGFuZ2UpPVwib25EYXRlQ2hhbmdlKCRldmVudClcIj5cbiAgICAgICAgICAgIDxzYXQtZGF0ZXBpY2tlclxuICAgICAgICAgICAgICAgIFtkaXNhYmxlZF09XCJmYWxzZVwiXG4gICAgICAgICAgICAgICAgI3Jlc3VsdFBpY2tlciBbcmFuZ2VNb2RlXT1cInRydWVcIj5cbiAgICAgICAgICAgIDwvc2F0LWRhdGVwaWNrZXI+XG5cbiAgICAgICAgICAgIDxkaXYgbWF0U3VmZml4IGZ4RmxleD1cIjEwXCI+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBtYXQtaWNvbi1idXR0b24gbWF0VG9vbHRpcD1cIkxpbXBpYXIgZmlsdHJvXCIgKGNsaWNrKT1cImNsZWFyUmFuZ2UoJGV2ZW50KVwiPlxuICAgICAgICAgICAgICAgICAgICA8bWF0LWljb24+Y2xlYXI8L21hdC1pY29uPlxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvbWF0LW9wdGlvbj5cblxuICAgICAgICA8bWF0LW9wdGlvbiAoY2xpY2spPVwiYXBwbHlUb2RheSgpXCI+SG95PC9tYXQtb3B0aW9uPlxuICAgICAgICA8bWF0LW9wdGlvbiAoY2xpY2spPVwiYXBwbHlMYXN0V2VlaygpXCI+w5psdGltYSBzZW1hbmE8L21hdC1vcHRpb24+XG4gICAgICAgIDxtYXQtb3B0aW9uIChjbGljayk9XCJhcHBseUN1cnJlbnRNb250aCgpXCI+RXN0ZSBtZXM8L21hdC1vcHRpb24+XG4gICAgICAgIDxtYXQtb3B0aW9uIChjbGljayk9XCJhcHBseWxhc3RNb250aCgpXCI+RWwgbWVzIHBhc2FkbzwvbWF0LW9wdGlvbj5cbiAgICA8L21hdC1zZWxlY3Q+XG48L21hdC1mb3JtLWZpZWxkPlxuYCxcbiAgICBwcm92aWRlcnM6IFtEYXRlUGlwZV0sXG4gICAgc3R5bGVzOiBbYG1hdC1mb3JtLWZpZWxke2ZvbnQtc2l6ZToxNXB4fWBdXG59KVxuZXhwb3J0IGNsYXNzIFJhbmdlRGF0ZXBpY2tlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgcHVibGljIGRhdGU6IFNhdERhdGVwaWNrZXJSYW5nZVZhbHVlPERhdGU+O1xuICAgIHB1YmxpYyBsYXN0RGF0ZUlucHV0OiBTYXREYXRlcGlja2VyUmFuZ2VWYWx1ZTxEYXRlPiB8IG51bGw7XG4gICAgcHVibGljIGxhc3REYXRlQ2hhbmdlOiBTYXREYXRlcGlja2VyUmFuZ2VWYWx1ZTxEYXRlPiB8IG51bGw7XG4gICAgcHVibGljIGxhYmVsOiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKSBwdWJsaWMgc3RhcnREYXRlOiBEYXRlO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBlbmREYXRlOiBEYXRlO1xuXG4gICAgQE91dHB1dCgpIHB1YmxpYyBzdGFydERhdGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGU+KCk7XG4gICAgQE91dHB1dCgpIHB1YmxpYyBlbmREYXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxEYXRlPigpO1xuICAgIEBPdXRwdXQoKSBwdWJsaWMgdXBkYXRlRGF0ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBkYXRlUGlwZTogRGF0ZVBpcGUpIHt9XG5cbiAgICBwdWJsaWMgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMubGFiZWwgPSAnUmFuZ28gZGUgZmVjaGEnO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkRhdGVJbnB1dChldmVudDogU2F0RGF0ZXBpY2tlcklucHV0RXZlbnQ8RGF0ZT4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5sYXN0RGF0ZUlucHV0ID0gZXZlbnQudmFsdWUgYXMgU2F0RGF0ZXBpY2tlclJhbmdlVmFsdWU8RGF0ZT47XG4gICAgICAgIHRoaXMudXBkYXRlRGF0ZUNoYW5nZSh0aGlzLmxhc3REYXRlSW5wdXQuYmVnaW4sIHRoaXMubGFzdERhdGVJbnB1dC5lbmQpO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkRhdGVDaGFuZ2UoZXZlbnQ6IFNhdERhdGVwaWNrZXJJbnB1dEV2ZW50PERhdGU+KTogdm9pZCB7XG4gICAgICAgIHRoaXMubGFzdERhdGVDaGFuZ2UgPSBldmVudC52YWx1ZSBhcyBTYXREYXRlcGlja2VyUmFuZ2VWYWx1ZTxEYXRlPjtcbiAgICAgICAgdGhpcy51cGRhdGVEYXRlQ2hhbmdlKHRoaXMubGFzdERhdGVDaGFuZ2UuYmVnaW4sIHRoaXMubGFzdERhdGVDaGFuZ2UuZW5kKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYXBwbHlDdXN0b21SYW5nZShldmVudCwgcGlja2VyKTogdm9pZCB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBwaWNrZXIub3BlbigpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhcHBseUxhc3RXZWVrKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmVuZERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLnN0YXJ0RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHRoaXMuc3RhcnREYXRlLnNldERhdGUodGhpcy5lbmREYXRlLmdldERhdGUoKSAtIDYpO1xuICAgICAgICB0aGlzLmRhdGUgPSB7IGJlZ2luOiB0aGlzLnN0YXJ0RGF0ZSwgZW5kOiB0aGlzLmVuZERhdGUgfTtcbiAgICAgICAgdGhpcy51cGRhdGVEYXRlQ2hhbmdlKHRoaXMuc3RhcnREYXRlLCB0aGlzLmVuZERhdGUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhcHBseVRvZGF5KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0YXJ0RGF0ZSA9IHRoaXMuZW5kRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHRoaXMuZGF0ZSA9IHsgYmVnaW46IHRoaXMuc3RhcnREYXRlLCBlbmQ6IHRoaXMuZW5kRGF0ZSB9O1xuICAgICAgICB0aGlzLnVwZGF0ZURhdGVDaGFuZ2UodGhpcy5zdGFydERhdGUsIHRoaXMuZW5kRGF0ZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGFwcGx5Q3VycmVudE1vbnRoKCk6IHZvaWQge1xuICAgICAgICBsZXQgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLnN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHRvZGF5LmdldEZ1bGxZZWFyKCksIHRvZGF5LmdldE1vbnRoKCksIDEpO1xuICAgICAgICB0aGlzLmVuZERhdGUgPSBuZXcgRGF0ZSh0b2RheS5nZXRGdWxsWWVhcigpLCB0b2RheS5nZXRNb250aCgpICsgMSwgMCk7XG4gICAgICAgIHRoaXMuZGF0ZSA9IHsgYmVnaW46IHRoaXMuc3RhcnREYXRlLCBlbmQ6IHRoaXMuZW5kRGF0ZSB9O1xuICAgICAgICB0aGlzLnVwZGF0ZURhdGVDaGFuZ2UodGhpcy5zdGFydERhdGUsIHRoaXMuZW5kRGF0ZSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNsZWFyUmFuZ2UoZXZlbnQpOiB2b2lkIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMuZGF0ZSA9IG51bGw7XG4gICAgICAgIHRoaXMudXBkYXRlRGF0ZUNoYW5nZShudWxsLCBudWxsKTtcbiAgICAgICAgdGhpcy5sYWJlbCA9ICdSYW5nbyBkZSBmZWNoYSc7XG4gICAgfVxuXG4gICAgcHVibGljIGFwcGx5bGFzdE1vbnRoKCk6IHZvaWQge1xuICAgICAgICBsZXQgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLnN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHRvZGF5LmdldEZ1bGxZZWFyKCksIHRvZGF5LmdldE1vbnRoKCkgLSAxLCAxKTtcbiAgICAgICAgdGhpcy5lbmREYXRlID0gbmV3IERhdGUodG9kYXkuZ2V0RnVsbFllYXIoKSwgdG9kYXkuZ2V0TW9udGgoKSwgMCk7XG4gICAgICAgIHRoaXMuZGF0ZSA9IHsgYmVnaW46IHRoaXMuc3RhcnREYXRlLCBlbmQ6IHRoaXMuZW5kRGF0ZSB9O1xuICAgICAgICB0aGlzLnVwZGF0ZURhdGVDaGFuZ2UodGhpcy5zdGFydERhdGUsIHRoaXMuZW5kRGF0ZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVEYXRlQ2hhbmdlKHN0YXJ0X2RhdGU6IERhdGUsIGVuZF9kYXRlOiBEYXRlKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3RhcnREYXRlID0gc3RhcnRfZGF0ZTtcbiAgICAgICAgdGhpcy5lbmREYXRlID0gZW5kX2RhdGU7XG4gICAgICAgIHRoaXMubGFiZWwgPSB0aGlzLnRvZ2dsZVByZXZpZXdUZXh0KHN0YXJ0X2RhdGUsIGVuZF9kYXRlKTtcbiAgICAgICAgdGhpcy5zdGFydERhdGVDaGFuZ2UuZW1pdCh0aGlzLmZvcm1hdERhdGVBbmRBZGRUaW1lKHN0YXJ0X2RhdGUsIHN0YXJ0X3RpbWUpKTtcbiAgICAgICAgdGhpcy5lbmREYXRlQ2hhbmdlLmVtaXQodGhpcy5mb3JtYXREYXRlQW5kQWRkVGltZShlbmRfZGF0ZSwgZW5kX3RpbWUpKTtcbiAgICAgICAgdGhpcy51cGRhdGVEYXRlLmVtaXQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZVByZXZpZXdUZXh0KHN0YXJ0X2RhdGU6IERhdGUsIGVuZF9kYXRlPzogRGF0ZSk6IHN0cmluZyB7XG4gICAgICAgIGlmIChzdGFydF9kYXRlICYmIGVuZF9kYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVQcmV2aWV3VGV4dChzdGFydF9kYXRlLCBlbmRfZGF0ZSkudG9VcHBlckNhc2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdGFydF9kYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXREYXlzKHN0YXJ0X2RhdGUpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW5kX2RhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERheXMoZW5kX2RhdGUpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldERheXMoZGF0ZTogRGF0ZSk6IHN0cmluZyB7XG4gICAgICAgIGxldCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmIChkYXRlLmdldERhdGUoKSA9PT0gdG9kYXkuZ2V0RGF0ZSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2hveSc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5kYXRlUGlwZS50cmFuc2Zvcm0oZGF0ZSwgJ2RkIE1NTSB5eXl5Jyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVQcmV2aWV3VGV4dChzdGFydF9kYXRlOiBEYXRlLCBlbmRfZGF0ZTogRGF0ZSk6IHN0cmluZyB7XG4gICAgICAgIGlmIChzdGFydF9kYXRlLmdldEZ1bGxZZWFyKCkgIT09IGVuZF9kYXRlLmdldEZ1bGxZZWFyKCkpIHtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRlUGlwZS50cmFuc2Zvcm0oc3RhcnRfZGF0ZSwgJ2RkIE1NTSB5eXl5IC0gJykgK1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0ZVBpcGUudHJhbnNmb3JtKGVuZF9kYXRlLCAnZGQgTU1NIHl5eXknKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdGFydF9kYXRlLmdldE1vbnRoKCkgPT09IGVuZF9kYXRlLmdldE1vbnRoKCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBhcmVEYXlzT2ZUaGVTYW1lTW9udGgoKSkgcmV0dXJuIHRoaXMuZ2V0RGF5cyhzdGFydF9kYXRlKTtcblxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGVQaXBlLnRyYW5zZm9ybShzdGFydF9kYXRlLCAnZGQgLSAnKSArXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRlUGlwZS50cmFuc2Zvcm0oZW5kX2RhdGUsICdkZCcpICtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGVQaXBlLnRyYW5zZm9ybShlbmRfZGF0ZSwgJyBNTU0geXl5eScpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIHRoaXMuZGF0ZVBpcGUudHJhbnNmb3JtKHN0YXJ0X2RhdGUsICdkZCBNTU0gLSAnKSArXG4gICAgICAgICAgICB0aGlzLmRhdGVQaXBlLnRyYW5zZm9ybShlbmRfZGF0ZSwgJ2RkIE1NTScpICtcbiAgICAgICAgICAgIHRoaXMuZGF0ZVBpcGUudHJhbnNmb3JtKGVuZF9kYXRlLCAnIHl5eXknKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgY29tcGFyZURheXNPZlRoZVNhbWVNb250aCgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhcnREYXRlLmdldERhdGUoKSA9PT0gdGhpcy5lbmREYXRlLmdldERhdGUoKSkgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmb3JtYXREYXRlQW5kQWRkVGltZShkYXRlOiBEYXRlLCB0aW1lOiBBcnJheTxudW1iZXI+KTogRGF0ZSB7XG4gICAgICAgIGRhdGUuc2V0SG91cnModGltZVswXSwgdGltZVsxXSwgdGltZVsyXSk7XG5cbiAgICAgICAgcmV0dXJuIGRhdGU7XG4gICAgfVxufVxuIl19